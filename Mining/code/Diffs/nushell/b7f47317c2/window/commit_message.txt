Fix quadratic time complexity with large strides (#6727)