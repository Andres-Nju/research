persist: fix handling of empty batches in compaction (#15105)

