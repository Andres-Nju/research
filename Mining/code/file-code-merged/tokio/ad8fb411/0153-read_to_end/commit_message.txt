io: fix unsoundness in read_to_end (#3428)

