Fix crash on changing from empty scratch buffer to itself (#975)

