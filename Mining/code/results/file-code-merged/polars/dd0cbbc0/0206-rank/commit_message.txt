fix so rank (#4114)

